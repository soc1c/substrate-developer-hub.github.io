<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>使用 Substrate 构建私人网络 · Substrate Developer Hub (@5517ab14)</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;在这个教程中，我们将学习和实践如何使用Substrate启动一个区块链网络，并使用你选择的验证者/管理者集合。&lt;/p&gt;
"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="使用 Substrate 构建私人网络 · Substrate Developer Hub (@5517ab14)"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="&lt;p&gt;在这个教程中，我们将学习和实践如何使用Substrate启动一个区块链网络，并使用你选择的验证者/管理者集合。&lt;/p&gt;
"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub (@5517ab14)"/><h2 class="headerTitleWithLogo">Substrate Developer Hub (@5517ab14)</h2></a><a href="/zh-CN/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/docs" target="_self">文档</a></li><li class=""><a href="/recipes/" target="_self">Recipes</a></li><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/zh-CN/community" target="_self">社区</a></li><li class=""><a href="https://github.com/paritytech/substrate" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/tutorials/start-a-private-network-with-substrate">English</a></li><li><a href="/docs/ru/next/tutorials/start-a-private-network-with-substrate">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 class="postHeaderTitle">使用 Substrate 构建私人网络</h1></header><article><div><span><p>在这个教程中，我们将学习和实践如何使用Substrate启动一个区块链网络，并使用你选择的验证者/管理者集合。</p>
<p>你需要：</p>
<ol>
<li>一个 Linux 或 Mac 操作系统下的命令行客户端</li>
<li>Git</li>
</ol>
<p>您将学习到：</p>
<ol>
<li>从源代码编译一个 Substrate 节点。</li>
<li>Generate ed25519 and sr25519 key-pairs for use as a network authority</li>
<li>创建和编辑 chainspec json 文件</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="编译所需工具"></a><a href="#编译所需工具" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编译所需工具</h2>
<p>Substrate (目前) 没有提供二进制安装包，因此必须从源代码中编译它，这可能是一个耗时的过程。 <a href="https://github.com/paritytech/substrate">Substrate 仓库</a> 会经常更新，请确保参加此网络的每个人都有同样版本的 Substrate 以保证成功。 In this tutorial, we'll be using commit <code>7d7e74fb</code> because it is the same commit that <a href="https://github.com/substrate-developer-hub/substrate-package/">Substrate Package</a> uses in version 1.5.0.</p>
<pre><code class="hljs css language-bash"><span class="token comment"># Install rust prerequisites</span>
<span class="token function">curl</span> https://getsubstrate.io -sSf <span class="token operator">|</span> <span class="token function">bash</span> -s -- --fast

<span class="token comment"># Download the Substrate code</span>
<span class="token function">git</span> clone https://github.com/paritytech/substrate
<span class="token function">cd</span> substrate

<span class="token comment"># Switch to the proper commit</span>
<span class="token function">git</span> checkout 7d7e74fb
</code></pre>
<p>The repository includes a utility called <code>subkey</code> which we'll optionally use to generate and inspect keypairs. 让我们先编译它。 The <code>--force</code> option means that we'll install this version by overriding the previously installed version.</p>
<pre><code class="hljs css language-bash"><span class="token comment"># Compile subkey</span>
cargo <span class="token function">install</span> --force --path subkey subkey
</code></pre>
<p>现在让我们编译我们将要运行的区块链节点。 由于 Substrate 是一个框架，大多数现实世界中的区块链将使用它编写自定义的 runtime 代码。 有 <a href="/tutorials/">其他教程</a> 详细涵盖这方面的内容。 幸运的是，Substrate 仓库本身已经有两个随时可以运行的节点环境。 第一个在 <code>node</code> 目录，它包含了许多功能，可以构建实际可行的区块链。 事实上，它看起来和 <a href="https://polkadot.network">Polkadot</a> 类似，Polkadot 也是基于 Substrate 构建的。 The second is a more minimal runtime that lives in the <code>node-template</code> directory. 我们将在本教程中使用节点模板 <code>node-template</code> ，因为它比较简单，通常是编写自定义 runtime 的起点。</p>
<pre><code class="hljs css language-bash"><span class="token comment"># Switch to node-template directory</span>
<span class="token function">cd</span> node-template

<span class="token comment"># Ensure your Rust toolchain is up to date</span>
./scripts/init.sh

<span class="token comment"># Compile the node-template</span>
cargo build --release
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="alice-和-bob-启动区块链"></a><a href="#alice-和-bob-启动区块链" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alice 和 Bob 启动区块链</h2>
<p>在我们生成自己的密钥并开始一个真正独特的 Substrate 网络之前，让我们了解下基础知识，首先使用一个预先定义的网络规范，称为 <code>local</code> ，使用两个预先定义的密钥 (当然不是私人的!)，称为 Alice 和 Bob。</p>
<h3><a class="anchor" aria-hidden="true" id="alice-首先启动"></a><a href="#alice-首先启动" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alice 首先启动</h3>
<p>Alice 应该从 Substrate 仓库的根目录运行此命令。</p>
<pre><code class="hljs css language-bash"><span class="token comment"># 如果你仍然在 node-template/ 目录</span>
<span class="token function">cd</span> <span class="token punctuation">..</span>

<span class="token comment"># Start the node</span>
./target/release/node-template \
  --base-path /tmp/alice \
  --chain<span class="token operator">=</span>local \
  --alice \
  --port 30333 \
  --telemetry-url ws://telemetry.polkadot.io:1024 \
  --validator
</code></pre>
<p>Let's look at those flags in detail:</p>
<ul>
<li><code>--base-path</code> 指定一个目录，Substrate 用它来存储与此链有关的所有数据。 如果目录不存在，将创建它。 如果已经存在其它区块链的数据，启动将会报错。 这种情况下，要么清除目录，要么选择不同的目录。</li>
<li><code>--chain=local</code> 指定要使用的链规范。 有几个预先准备的选项，包括 <code>local</code> <code>development</code> 和 <code>staging</code> ，但更常见的是我们指定自己的 chainspec 文件。 我们将在稍后阶段指定自己的文件。</li>
<li><code>--alice</code> Puts the pre-defined Alice keys (both for block production and finalization) in the node's keystore. Generally one should generate their own key with <code>subkey</code> and insert them with an RPC call. 我们将在稍后阶段指定自己的秘钥。</li>
<li><code>--port 30333</code> 指定节点将监听的 p2p 端口。 30333是默认值，如果默认值可以，可以忽略此 flag。 如果 Bob 的节点在同一物理机上运行，您需要明确指定一个不同的端口。</li>
<li><code>--telemetry-url</code> 告诉节点，将监测数据发送到特定的服务器。 我们在这里选择了由 Parity 维护、可供任何人使用的监测服务器。 You may also host your own (beyond the scope of this article) or omit this flag entirely.</li>
<li><code>--validator</code> Means that we want to participate in block production and finalization rather than just sync the network.</li>
</ul>
<p>当节点启动后，你应该看到类似下面的输出：</p>
<pre><code class="hljs">2019-09-26 15:42:10 Substrate Node
2019-09-26 15:42:10   version 2.0.0-7d7e74fb7-x86_64-linux-gnu
2019-09-26 15:42:10   by Anonymous, 2017, 2018
2019-09-26 15:42:10 Chain specification: Local Testnet
2019-09-26 15:42:10 Node name: Alice
2019-09-26 15:42:10 Roles: AUTHORITY
2019-09-26 15:42:10 Initializing Genesis block/state (state: 0x4faf…3aba, header-hash: 0x8855…e564)
2019-09-26 15:42:10 Loading GRANDPA authority set from genesis on what appears to be first startup.
2019-09-26 15:42:10 Loaded block-time = BabeConfiguration { slot_duration: 6000, epoch_length: 100, c: (1, 4), genesis_authorities: [(Public(d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d (5GrwvaEF...)), 1), (Public(8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48 (5FHneW46...)), 1)], randomness: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], secondary_slots: true } seconds from genesis on first-launch
2019-09-26 15:42:10 Creating empty BABE epoch changes on what appears to be first startup.
2019-09-26 15:42:10 Highest known block at #0
2019-09-26 15:42:10 Using default protocol ID &quot;sup&quot; because none is configured in the chain specs
2019-09-26 15:42:10 Local node identity is: QmViTYm8Yr4yneyRGov9L87vLeVLoySFduVRNQ1d33WdXN
2019-09-26 15:42:10 Starting BABE Authorship worker
2019-09-26 15:42:15 Idle (0 peers), best: #0 (0x8855…e564), finalized #0 (0x8855…e564), ⬇ 0 ⬆ 0
2019-09-26 15:42:20 Idle (0 peers), best: #0 (0x8855…e564), finalized #0 (0x8855…e564), ⬇ 0 ⬆ 0
</code></pre>
<p>A few lines to take note of: <code>Local node identity is: QmViTYm8Yr4yneyRGov9L87vLeVLoySFduVRNQ1d33WdXN</code> shows the node ID that Bob will need when booting from Alice's node. <code>Initializing Genesis block/state (state: 0x4faf…3aba, header-hash: 0x8855…e564)</code> tells which genesis block the node is using. Bob's node must have the same numbers or they will not connect to one another.</p>
<p>More details about all of these flags and others that I haven't mentioned are available by running <code>./target/release/node-template --help</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="连接ui"></a><a href="#连接ui" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连接UI</h3>
<p>你可以通过节点在命令行中产生的输出了解很多信息。 还有一个很好的图形用户界面，称为<a href="https://polkadot.js.org/apps/"> Polkadot Js Apps UI </a>，可以将它连接到你的节点。 此链接会跳转到该UI的官方托管网页，非常方便，但与你正在运行的 Substrate 版本相比可能已经过时。 在托管的UI页面过期的情况下，你可以通过从<a href="https://github.com/polkadot-js/apps"> github </a>获取代码在本地运行该应用。 一般来说，该仓库中的指令将是你的最佳指南，但过程应该是这样的。</p>
<pre><code class="hljs css language-bash"><span class="token comment"># 抓取代码</span>
<span class="token function">git</span> clone https://github.com/polkadot-js/apps
<span class="token function">cd</span> apps

<span class="token comment"># 安装依赖</span>
<span class="token function">yarn</span>

<span class="token comment"># 启动项目</span>
<span class="token function">yarn</span> run start
</code></pre>
<p>Point your favorite web browser at localhost:3000, and on the settings tab, choose &quot;local node&quot;. 你应该看到类似下面的内容：</p>
<p><img src="https://cdn.discordapp.com/attachments/559788157239951376/580368220364603392/unknown.png" alt="No blocks in polkadot-js-apps"></p>
<p>你会注意到，在命令行和用户界面中，还没有生产任何块。 一旦另一个验证者加入网络，块将开始生成。</p>
<h3><a class="anchor" aria-hidden="true" id="bob-加入"></a><a href="#bob-加入" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bob 加入</h3>
<p>现在，Alice节点已经启动并运行，Bob 可以通过引导节点来加入网络。 他的命令看起来非常类似下面：</p>
<pre><code class="hljs css language-bash">./target/release/node-template \
  --base-path /tmp/bob \
  --chain<span class="token operator">=</span>local \
  --bob \
  --port 30334 \
  --telemetry-url ws://telemetry.polkadot.io:1024 \
  --validator \
  --bootnodes /ip4/<span class="token operator">&lt;</span>Alices IP Address<span class="token operator">></span>/tcp/<span class="token operator">&lt;</span>Alices Port<span class="token operator">></span>/p2p/<span class="token operator">&lt;</span>Alices Node ID<span class="token operator">></span>
</code></pre>
<p>上面已经解释了大多数这些选项，但有几个要点。</p>
<ul>
<li>如果这两个节点在同一物理机器上运行，Bob 必须指定了一个不同的 <code>--base-path</code> 和 <code>--port</code>。</li>
<li>Bob 添加了 <code>--bootnodes</code> flag 来指定一个启动节点，即 Alice 节点。 他必须正确指定这三项，Alice 可以为他提供的这三条信息。
<ul>
<li>Alice IP Address 的格式 <code>192.168.1.1</code></li>
<li>Alice的端口，可能为30333</li>
<li>Alice节点ID，从她的日志输出中复制。 (<code>QmViTYm8Yr4yneyRGov9L87vLeVLoySFduVRNQ1d33WdXN</code> in the example output above.)</li>
</ul></li>
</ul>
<p>如果所有进展顺利，在几秒之后，节点应该相互连接，开始生成区块。 你应该看到类似下面的内容：</p>
<pre><code class="hljs">Idle (1 peers), best: #1 (0x9f1b…9b57), finalized #1 (0x28be…45e5), ⬇ 1.7kiB/s ⬆ 1.4kiB/s
</code></pre>
<p>This line shows that Bob has peered with Alice (<code>1 peers</code>), they have produced a block (<code>best: #1 (0x9f1b…9b57)</code>), and the block is finalized (<code>finalized #1 (0x28be…45e5)</code>).</p>
<h2><a class="anchor" aria-hidden="true" id="生成密钥"></a><a href="#生成密钥" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成密钥</h2>
<p>现在我们知道了基本原理和命令行选项，现在是时候生成我们自己的密钥而不是使用众所周知的 Alice 和 Bob 密钥。 Each person who wants to participate in the blockchain can generate their own key using the <a href="ecosystem/subkey">subkey tool</a>. Be sure to record all of the output from this section as you will need it later.</p>
<blockquote>
<p>If you aren't interested in learning to generate your own keys, you may use the example keys below for learning purposes. But you must generate your own before starting any production network.</p>
</blockquote>
<p>First generate a mnemonic and see the <code>sr25519</code> key and address associated with it. This key will be used by BABE for block production.</p>
<pre><code class="hljs">$ subkey generate
Secret phrase `keep matrix knee meat awake frown rubber position federal easily strategy inhale` is account:
  Secret seed: 0xb5d5cda89e139aecb67181e11d6d2d90a0cc80106afa035ab19264af7b5e5c0b
  Public key (hex): 0x8ed5f822065e5824d3e37d9ea36a81eacb98ff1a6fa04bb87d2fa4915e9ed147
  Address (SS58): 5FHzDem7A5aAq79tuEN9xJuNPXiYfmRQamhumTuqu6i57BuU
</code></pre>
<p>Now see the <code>ed25519</code> key and address associated with the same mnemonic. This key will be used by GRANDPA for block finalization.</p>
<pre><code class="hljs">$ subkey --ed25519 inspect &quot;keep matrix knee meat awake frown rubber position federal easily strategy inhale&quot;
Secret phrase `keep matrix knee meat awake frown rubber position federal easily strategy inhale` is account:
  Secret seed: 0xb5d5cda89e139aecb67181e11d6d2d90a0cc80106afa035ab19264af7b5e5c0b
  Public key (hex): 0xfe68fdff17960cb8d45d861396a64d4086997353849403ee3352996ec68ff4af
  Address (SS58): 5HpHD5YseSWbHfni43Zm2SjtpyqSVmuaNhKkVmivp8L93Trs
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="creating-the-chainspec"></a><a href="#creating-the-chainspec" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the Chainspec</h2>
<p>上一次，我们使用<code>--chain=local</code>这是一个预定义的“chainspec”，它将 Alice 和 Bob 指定为验证人以及许多其他有用的默认值。</p>
<p>我们不是从头开始完全编写 chainpec，而是对我们之前使用的那些进行一些修改。 首先，我们需要将 chainspec 导出到 json 文件。 请记住，运行<code>node-template --help</code>可以获得有关所有这些命令的更多详细信息。</p>
<pre><code class="hljs css language-bash">./target/release/node-template build-spec --chain<span class="token operator">=</span>local <span class="token operator">></span> customSpec.json
</code></pre>
<p>我们刚创建的文件包含几个字段，人们可以通过探索它们来学习很多东西。 By far the largest field is a single hex number that is the Wasm binary of our runtime. It is part of what you built earlier when you ran the <code>cargo build</code> command. Having this information on-chain allows supports forkless upgrades.</p>
<p>The portion of the file we're interested in is the BABE authorities (used for creating blocks) and the GRANDPA authorities (used for finalizing blocks). That section looks like this</p>
<pre><code class="hljs css language-json"><span class="token property">"babe"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"authorities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string">"5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty"</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">"grandpa"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"authorities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"5FA9nQDVg267DEd8m1ZypXLBnvN7SFxYwV7ndqSYGiN9TTpu"</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string">"5GoNkf6WdbxCFnPdAnYYQyCjAKPJgLNxXwPjwTh6DGg6gN3E"</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre>
<p>All we need to do is change the authority addresses listed (currently Alice and Bob) to our own addresses that we generated in the previous step. The sr25519 addresses go in the <code>babe</code> section, and the ed25519 addresses in the <code>grandpa</code> section. You may add as many validators as you like. To see how polkadot uses these keys and others in the <a href="https://wiki.polkadot.network/docs/en/learn-keys#session-keys">Polkadot wiki</a>.</p>
<blockquote>
<p>A single person should do these steps and share the resulting file with their fellow validators.</p>
<p>Because Rust -&gt; Wasm builds aren't &quot;reproducible&quot;, each person will get a slightly different Wasm blob which will break consensus if each participant generates the file themselves.</p>
</blockquote>
<p>准备好 chainspec 后，将其转换为“raw” chainspec。 regular 和 raw 之间的区别只是所有字段名称在 raw chainspec 中编码为十六进制。 在那里探索没什么好玩的。</p>
<pre><code class="hljs css language-bash">./target/release/node-template build-spec --chain customSpec.json --raw <span class="token operator">></span> customSpecRaw.json
</code></pre>
<p>最后与网络中的所有其他验证人共享<code>customSpecRaw.json</code>。</p>
<h2><a class="anchor" aria-hidden="true" id="launching-the-chain"></a><a href="#launching-the-chain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Launching the Chain</h2>
<h3><a class="anchor" aria-hidden="true" id="first-participant-starts-a-bootnode"></a><a href="#first-participant-starts-a-bootnode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First Participant starts a Bootnode</h3>
<p>你已完成所有必要的准备工作，现在准备好启动链。 此过程非常类似于之前以 Alice 和 Bob 的身份启动链。 从干净的基础路径开始非常重要，如果你打算使用之前的路径，请删除该目录中的所有内容。</p>
<p>第一位参与者启动节点</p>
<pre><code class="hljs css language-bash">./target/release/node-template \
  --chain ./customSpecRaw.json \
  --port 30333 \
  --telemetry-url ws://telemetry.polkadot.io:1024 \
  --validator
  --name MyNode
</code></pre>
<p>以下是我们启动 Alice 时的一些不同之处。</p>
<ul>
<li>我省略了<code>--base-path</code> flag，因此 Substrate 将使用默认位置。 你仍然可以自由地指定路径。</li>
<li>I've omitted the <code>--alice</code> flag. Instead we will insert our own custom keys into the keystore through the RPC shortly.</li>
<li><code>--chain</code> flag 已更改以使用我们自定义的链。</li>
<li>I've added the optional <code>--name</code> flag. You may use it to give your node a human-readable name in the telemetry UI.</li>
</ul>
<p>One your node is running, you will again notice that no blocks are being produced. At this point you can use the Apps UI to insert your keys into the keystore. Navigate to the &quot;Toolbox&quot; tab and the &quot;RPC Call&quot; sub-tab. Choose &quot;author&quot; and &quot;insertKey&quot;. The fields can be filled like this:</p>
<pre><code class="hljs">keytype: babe
suri: your mnemonic phrase (eg keep matrix knee meat awake frown rubber position federal easily strategy inhale)
publicKey: your sr25519 key (eg 0x8ed5f822065e5824d3e37d9ea36a81eacb98ff1a6fa04bb87d2fa4915e9ed147)
</code></pre>
<p>You've now successfully inserted your babe key. You can repeat those steps to insert your grandpa key (the ed25519 key)</p>
<pre><code class="hljs">keytype: gran
suri: your mnemonic phrase (eg keep matrix knee meat awake frown rubber position federal easily strategy inhale)
publicKey: your ed25519 key (eg 0xfe68fdff17960cb8d45d861396a64d4086997353849403ee3352996ec68ff4af)
</code></pre>
<p>Finally, restart your node so that the keys just added to the keystore take effect.</p>
<h3><a class="anchor" aria-hidden="true" id="subsequent-participants-join"></a><a href="#subsequent-participants-join" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subsequent Participants Join</h3>
<p>Subsequent validators can now join the network as Bob did previously, making sure to use the new chainspec. 你可以从<em>任意</em>网络中已有的节点引导，而不仅仅是先前的节点。</p>
<p>Each participant will need to start their node, add both keys to the keystore, and restart their node.</p>
<blockquote>
<p>Reminder: All validators must be using identical chain specifications in order to peer. You should see the same genesis block and state root hashes.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<p>恭喜你！ 你已启动了自己的区块链！</p>
<p>在这个教程中，你学会了编译节点模板，生成自己的公私钥对，创建一个自定义的链，使用这些密钥对，并根据自定义 chainspec 和节点模板启动了一个私有区块链网络。</p>
<p>以下是接下来要学习的内容的一些想法。</p>
<h3><a class="anchor" aria-hidden="true" id="使用全节点"></a><a href="#使用全节点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用全节点</h3>
<p>你可以使用位于<code>node</code>目录中的 Substrate 的全节点，而不是我们使用的<code>node-template</code>，完成一个非常类似的过程。 你应该熟悉该过程，并且将开始探索全节点中包含的更多 runtime 模块。</p>
<h3><a class="anchor" aria-hidden="true" id="创世后添加验证人"></a><a href="#创世后添加验证人" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创世后添加验证人</h3>
<p>如果想在启动区块链后添加更多验证人，该怎么办？ 你不能再返回并编辑那里的 chainspec。 The authority set can be changed after genesis by calling the consensus module's <a href="https://github.com/paritytech/substrate/blob/master/srml/consensus/src/lib.rs#L356-L362"><code>set_authorities</code> function</a>. 但是，该函数只能从其它 runtime 模块调用。 如果你已构建全节点，则可以使用 democracy 模块完成该任务。 或者查看<a href="https://github.com/gautamdhameja/substrate-poa">Substrate POA runtime</a>。</p>
<h3><a class="anchor" aria-hidden="true" id="编写一个自定义-runtime"></a><a href="#编写一个自定义-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编写一个自定义 Runtime</h3>
<p>Substrate 其实就是写自己的 runtime，现在你已经上手了，我鼓励你尝试写一个。 Consider one of the <a href="/tutorials/">tutorials</a>.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#编译所需工具">编译所需工具</a></li><li><a href="#alice-和-bob-启动区块链">Alice 和 Bob 启动区块链</a><ul class="toc-headings"><li><a href="#alice-首先启动">Alice 首先启动</a></li><li><a href="#连接ui">连接UI</a></li><li><a href="#bob-加入">Bob 加入</a></li></ul></li><li><a href="#生成密钥">生成密钥</a></li><li><a href="#creating-the-chainspec">Creating the Chainspec</a></li><li><a href="#launching-the-chain">Launching the Chain</a><ul class="toc-headings"><li><a href="#first-participant-starts-a-bootnode">First Participant starts a Bootnode</a></li><li><a href="#subsequent-participants-join">Subsequent Participants Join</a></li></ul></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#使用全节点">使用全节点</a></li><li><a href="#创世后添加验证人">创世后添加验证人</a></li><li><a href="#编写一个自定义-runtime">编写一个自定义 Runtime</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><div><style>
#blast {
  position: fixed;
  width: 100%;
  bottom: 0;
  height: 50px;
  background-image: url(/img/bg-sub01.svg); background-size: cover; background-position: right 0px bottom 500px;;
  color: #18FFB2;
  z-index: 99999;
  text-align: center;
  background-color: #000028;
  transition: background-color 0.2s;
}
#blast:hover {
  background-color: #E91E63;
}

#blast h2 {
  margin: 0;
  line-height: 50px;
}

#blast a {
  display: block;
  color: #18FFB2;
  text-decoration: underline;
  mix-blend-mode: lighten;
}

#blast img {
  max-height: 50px;
}

body {
  margin-bottom: 50px;
}
</style><section id="blast"><a href="https://sub0.parity.io" target="_blank"><img src="/img/sub0-blast.png" class="img-fluid"/></a></section></div><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub (@5517ab14)" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/zh-CN/getting-started">Getting Started</a><a href="/zh-CN/tutorials">Tutorials</a><a href="/rustdocs/v1.0/">Reference Docs</a><a href="/recipes/">Recipes</a></div><div><h5>Community</h5><a href="/zh-CN/videos">Videos</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2019 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>